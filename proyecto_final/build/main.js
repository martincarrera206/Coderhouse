(()=>{"use strict";var t={802:function(t,o,e){var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(o,"__esModule",{value:!0});const i=r(e(842));o.default=function(t,o,e){return(0,i.default)()?e():o.status(405).json({error:-1,descripcion:`Ruta '${t.originalUrl}' método '${t.method}' no autorizada `,fromIP:t.ip})}},969:(t,o,e)=>{Object.defineProperty(o,"__esModule",{value:!0});const r=(0,e(860).Router)();r.get("/",((t,o,e)=>(console.log("GET request recibido index"),o.render("index",{page_title:"Nuevo Producto",success_action:"",success:0,productos:[]})))),r.get("/productos",((t,o,e)=>{console.log("GET request recibido");return o.status(201).render("list_products",{productos:[],page_title:"Listado de Productos"})})),r.get("/admin",((t,o,e)=>{console.log("GET request recibido");return o.status(201).render("admin",{productos:[],page_title:"Panel de Administrador"})})),r.get("/chat",((t,o,e)=>o.status(201).render("chat"))),o.default=r},842:(t,o)=>{Object.defineProperty(o,"__esModule",{value:!0});let e=!0;o.default=function(t){if(!t)return e;e=t}},783:function(t,o,e){var r=this&&this.__awaiter||function(t,o,e,r){return new(e||(e=Promise))((function(i,s){function d(t){try{c(r.next(t))}catch(t){s(t)}}function n(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var o;t.done?i(t.value):(o=t.value,o instanceof e?o:new e((function(t){t(o)}))).then(d,n)}c((r=r.apply(t,o||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(o,"__esModule",{value:!0});const s=i(e(691)),d=i(e(147));class n{constructor(t,o,e){this.products=[],t&&(this.id=t),o&&(this.timestamp=o),e&&(this.products=e)}getId(){return this.id}getTimestamp(){return this.timestamp}getProducts(){return this.products}setProducts(t){this.products=t}addProduct(t){return r(this,void 0,void 0,(function*(){const o=null!=this.products&&this.products.length>=1?this.products[this.products.length-1]:void 0,e=null!=o&&void 0!==o.getId()?Number(o.getId())+1:1,r=Date.now();t.setId(e),t.setTimestamp(r),this.products.push(t),this.update()}))}updateProduct(t){return r(this,void 0,void 0,(function*(){for(let o=0;o<this.products.length;o++)this.products[o].getId()==t.getId()&&(this.products[o].setNombre(t.getNombre()),this.products[o].setDescripcion(t.getDescripcion()),this.products[o].setCodigo(t.getCodgio()),this.products[o].setPrecio(t.getPrecio()),this.products[o].setFoto(t.getFoto()),this.products[o].setStock(t.getStock()));this.update()}))}deleteProduct(t){return r(this,void 0,void 0,(function*(){this.products=this.products.filter(((o,e,r)=>o.getId()!==t)),this.update()}))}save(){return r(this,void 0,void 0,(function*(){let t=yield n.getAll();const o=null!=t&&t.length>=1?t[t.length-1]:void 0;return this.id=null!=o&&void 0!==o.id?o.id+1:1,this.timestamp=Date.now(),t.push(this),d.default.promises.writeFile(n.nombre_archivo,JSON.stringify(t,null,2)).catch((t=>{console.log({errorSave:t})})),this}))}update(){return r(this,void 0,void 0,(function*(){n.getAll().then((t=>{let o=[];for(let e=0;e<t.length;e++)t[e].getId()==this.getId()&&t[e].setProducts(this.getProducts()),o.push(t[e]),d.default.promises.writeFile(n.nombre_archivo,JSON.stringify(o,null,2)).catch((t=>{console.log({errorUpdate:t})}))}))}))}static getById(t){return r(this,void 0,void 0,(function*(){return(yield n.getAll().then((o=>{const e=o.find((o=>o.id==t));return null!=e&&null!=e.id?e:void 0})))||void 0}))}static getAll(){return r(this,void 0,void 0,(function*(){return(yield d.default.promises.readFile(n.nombre_archivo,"utf-8").then((t=>{let o=[];if(""===t||null==t)return o;{const e=JSON.parse(t);if(e)for(let t=0;t<e.length;t++){const r=e[t];if(r&&r.id&&r.timestamp){let t=[];if(r.products)for(let o=0;o<r.products.length;o++){const e=r.products[o],i=new s.default(e.nombre,e.descripcion,e.codigo,e.precio,e.foto,e.stock,e.id,e.timestamp);t.push(i)}const e=new n(r.id,r.timestamp,t);o.push(e)}}return o}})).catch((t=>{console.log({errorGetAll:t})})))||[]}))}static deleteById(t){return r(this,void 0,void 0,(function*(){const o=yield n.getAll(),e=[];for(let r=0;r<o.length;r++)o[r].id!==t&&e.push(o[r]);d.default.promises.writeFile(n.nombre_archivo,JSON.stringify(e,null,2)).catch((t=>{console.log({errorDeleteAll:t})}))}))}static deleteAll(){return r(this,void 0,void 0,(function*(){d.default.promises.writeFile(n.nombre_archivo,"","utf-8").catch((t=>{console.log({errorDeleteAll:t})}))}))}}o.default=n,n.nombre_archivo="./src/data/karts.json"},556:function(t,o,e){var r=this&&this.__awaiter||function(t,o,e,r){return new(e||(e=Promise))((function(i,s){function d(t){try{c(r.next(t))}catch(t){s(t)}}function n(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var o;t.done?i(t.value):(o=t.value,o instanceof e?o:new e((function(t){t(o)}))).then(d,n)}c((r=r.apply(t,o||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(o,"__esModule",{value:!0});const s=e(860),d=i(e(783)),n=i(e(691)),c=(0,s.Router)();c.get("/api/carrito",((t,o,e)=>{var i;console.log("GET kart recibido"),i=o,r(void 0,void 0,void 0,(function*(){const t=yield d.default.getAll();return i.status(201).json({carritos:t})}))})),c.get("/api/carrito/:id",((t,o,e)=>{var i,s;console.log("GET kart by ID recibido"),i=t,s=o,r(void 0,void 0,void 0,(function*(){const t=i.params.id?Number(i.params.id):0,o=yield d.default.getById(t);return o?s.status(201).json({carrito:o}):s.status(404).json({Error:"No se pudo encontrar el carrito deseado"})}))})),c.post("/api/carrito",((t,o,e)=>{var i;console.log("POST kart recibido"),i=o,r(void 0,void 0,void 0,(function*(){let t=new d.default;return t=yield t.save(),i.status(201).json({kart_id:t.getId()})}))})),c.delete("/api/carrito/:id",((t,o,e)=>{var i,s;console.log("DELETE kart recibido"),i=t,s=o,r(void 0,void 0,void 0,(function*(){const t=i.params.id?Number(i.params.id):0;return t<=0?s.status(404).json({Error:"No se pudo encontrar el carrito deseado"}):(d.default.deleteById(t),s.status(204).json({Message:"Exito al eliminar el carrito"}))}))})),c.get("/api/carrito/:id/productos",((t,o,e)=>{var i,s;console.log("GET kart -> product recibido"),i=t,s=o,r(void 0,void 0,void 0,(function*(){const t=i.params.id?Number(i.params.id):0,o=yield d.default.getById(t);if(o){const t=o.getProducts();return s.status(201).json({productos:t})}return s.status(404).json({Error:"No se pudo encontrar el carrito deseado"})}))})),c.post("/api/carrito/:id/productos",((t,o,e)=>{var i,s;console.log("POST kart -> product recibido"),i=t,s=o,r(void 0,void 0,void 0,(function*(){const t=i.params.id?Number(i.params.id):0;let o=yield d.default.getById(t);if(o){i.body.id_prod&&Number(i.params.id_prod);const t=i.body.nombre?String(i.body.nombre):"",e=i.body.precio?Number(i.body.precio):0,r=i.body.foto?String(i.body.foto):"",d=i.body.stock?Number(i.body.stock):0,c=i.body.descripcion?String(i.body.descripcion):"",u=i.body.codigo?String(i.body.codigo):"",a=new n.default(t,c,u,e,r,d);o.addProduct(a);const l=o.getProducts();return s.status(201).json({products:l})}return s.status(404).json({Error:"No se pudo encontrar el producto deseado"})}))})),c.put("/api/carrito/:id/productos/:id_prod",((t,o,e)=>{var i,s;console.log("PUT kart -> product recibido"),i=t,s=o,r(void 0,void 0,void 0,(function*(){const t=i.params.id?Number(i.params.id):0;if(yield d.default.getById(t)){const t=i.params.id_prod?Number(i.params.id_prod):0,o=i.body.nombre?String(i.body.nombre):"",e=i.body.precio?Number(i.body.precio):0,r=i.body.foto?String(i.body.foto):"",d=i.body.stock?Number(i.body.stock):0,c=i.body.descripcion?String(i.body.descripcion):"",u=i.body.codigo?String(i.body.codigo):"";if(t<=0)return s.status(404).json({Error:"No se pudo encontrar el producto dentro del carrito deseado"});let a=yield n.default.getById(t);return a?(a.setNombre(o),a.setPrecio(e),a.setFoto(r),a.setStock(d),a.setDescripcion(c),a.setCodigo(u),a.update(),s.status(201).json({product:a})):s.status(404).json({Error:"No se pudo encontrar el producto deseado"})}return s.status(404).json({Error:"No se pudo encontrar el carrito deseado"})}))})),c.delete("/api/carrito/:id/productos/:id_prod",((t,o,e)=>{var i,s;console.log("DELETE kart -> product recibido"),i=t,s=o,r(void 0,void 0,void 0,(function*(){const t=i.params.id?Number(i.params.id):0;let o=yield d.default.getById(t);if(o){const t=i.params.id_prod?Number(i.params.id_prod):0;return t<=0?s.status(404).json({Error:"No se pudo encontrar el producto dentro del carrito deseado"}):(o.deleteProduct(t),s.status(204).json({Message:"Exito al eliminar el producto"}))}return s.status(404).json({Error:"No se pudo encontrar el carrito deseado"})}))})),o.default=c},519:function(t,o,e){var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(o,"__esModule",{value:!0});const i=r(e(860)),s=e(439),d=e(952),n=(0,i.default)(),c=(0,s.createServer)(n),u=new d.Server(c);n.use(i.default.json()),n.use(i.default.urlencoded({extended:!0})),n.use(i.default.static("./public")),n.set("views","./src/views"),n.set("view engine","ejs");const a=r(e(969));n.use(a.default);const l=r(e(110));n.use(l.default);const p=r(e(556));n.use(p.default),n.use(((t,o,e)=>{const r=t.route,i=t.method;return r?e():o.status(404).json({error:-2,descripcion:`Ruta '${r}' método '${i}' no autorizada `})})),c.listen(8080,(()=>{console.log("Servidor Http escuchando en el puerto 8080")})),n.on("error",(t=>{console.log({generalError:t})}));let f=[],h=[];u.on("connection",(t=>{t.on("getProducts",(o=>{t.emit("loadProducts",[])})),t.on("joinChat",(o=>{const e={id:t.id,username:o.username,avatarId:Math.ceil(6*Math.random())};f.push(e),t.emit("loadUser",e),t.broadcast.emit("notification",`${e.username} se ha unido a la sala`),u.emit("users",f)})),t.on("messageInput",(o=>{const e=new Date,r=f.find((o=>o.id===t.id)),i={text:o,time:`${e.toLocaleString()}`,user:r};h.push(i),t.emit("myMessage",i),t.broadcast.emit("message",i)})),t.on("disconnect",(o=>{const e=f.find((o=>o.id===t.id));f=f.filter((o=>o.id!==t.id)),e&&t.broadcast.emit("notification",`${e.username} se ha ido al chat`),u.sockets.emit("users",f)}))}))},691:function(t,o,e){var r=this&&this.__awaiter||function(t,o,e,r){return new(e||(e=Promise))((function(i,s){function d(t){try{c(r.next(t))}catch(t){s(t)}}function n(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var o;t.done?i(t.value):(o=t.value,o instanceof e?o:new e((function(t){t(o)}))).then(d,n)}c((r=r.apply(t,o||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(o,"__esModule",{value:!0});const s=i(e(147));class d{constructor(t,o,e,r,i,s,d,n){this.nombre=t,this.precio=r,this.foto=i,this.stock=s,this.descripcion=o,this.codigo=e,d&&(this.id=d),n&&(this.timestamp=n)}getId(){return this.id}getTimestamp(){return this.timestamp}getNombre(){return this.nombre}getDescripcion(){return this.descripcion}getCodgio(){return this.codigo}getPrecio(){return this.precio}getFoto(){return this.foto}getStock(){return this.stock}setNombre(t){this.nombre=t}setDescripcion(t){this.descripcion=t}setCodigo(t){this.codigo=t}setPrecio(t){this.stock=t}setFoto(t){this.foto=t}setStock(t){this.stock=t}setId(t){this.id=t}setTimestamp(t){this.timestamp=t}save(){return r(this,void 0,void 0,(function*(){let t=yield d.getAll();const o=null!=t&&t.length>=1?t[t.length-1]:void 0;return this.id=null!=o&&void 0!==o.id?o.id+1:1,this.timestamp=Date.now(),t.push(this),s.default.promises.writeFile(d.nombre_archivo,JSON.stringify(t,null,2)).catch((t=>{console.log({errorSave:t})})),this}))}update(){return r(this,void 0,void 0,(function*(){d.getAll().then((t=>{let o=[];for(let e=0;e<t.length;e++)t[e].getId()==this.getId()&&(t[e].setNombre(this.getNombre()),t[e].setDescripcion(this.getDescripcion()),t[e].setCodigo(this.getCodgio()),t[e].setPrecio(this.getPrecio()),t[e].setFoto(this.getFoto()),t[e].setStock(this.getStock())),o.push(t[e]),s.default.promises.writeFile(d.nombre_archivo,JSON.stringify(o,null,2)).catch((t=>{console.log({errorUpdate:t})}))}))}))}static getById(t){return r(this,void 0,void 0,(function*(){return(yield d.getAll().then((o=>{const e=o.find((o=>o.id==t));return null!=e&&null!=e.id?e:void 0})))||void 0}))}static getAll(){return r(this,void 0,void 0,(function*(){return(yield s.default.promises.readFile(d.nombre_archivo,"utf-8").then((t=>{if(""===t||null==t)return[];{let o=[];const e=JSON.parse(t);if(e)for(let t=0;t<e.length;t++){const r=e[t],i=new d(r.nombre,r.descripcion,r.codigo,r.precio,r.foto,r.stock,r.id,r.timestamp);o.push(i)}return o}})).catch((t=>{console.log({errorGetAll:t})})))||[]}))}static deleteById(t){return r(this,void 0,void 0,(function*(){const o=yield d.getAll(),e=[];for(let r=0;r<o.length;r++)o[r].id!==t&&e.push(o[r]);s.default.promises.writeFile(d.nombre_archivo,JSON.stringify(e,null,2)).catch((t=>{console.log({errorDeleteAll:t})}))}))}static deleteAll(){return r(this,void 0,void 0,(function*(){s.default.promises.writeFile(d.nombre_archivo,"","utf-8").catch((t=>{console.log({errorDeleteAll:t})}))}))}}o.default=d,d.nombre_archivo="./src/data/products.json"},110:function(t,o,e){var r=this&&this.__awaiter||function(t,o,e,r){return new(e||(e=Promise))((function(i,s){function d(t){try{c(r.next(t))}catch(t){s(t)}}function n(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var o;t.done?i(t.value):(o=t.value,o instanceof e?o:new e((function(t){t(o)}))).then(d,n)}c((r=r.apply(t,o||[])).next())}))},i=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(o,"__esModule",{value:!0});const s=e(860),d=i(e(691)),n=i(e(802)),c=(0,s.Router)();c.get("/api/productos",((t,o,e)=>{var i;console.log("GET product recibido"),i=o,r(void 0,void 0,void 0,(function*(){const t=yield d.default.getAll();return i.status(201).json({productos:t})}))})),c.get("/api/productos/:id",((t,o,e)=>{var i,s;console.log("GET product by ID recibido"),i=t,s=o,r(void 0,void 0,void 0,(function*(){const t=i.params.id?Number(i.params.id):0,o=yield d.default.getById(t);return o?s.status(201).json({producto:o}):s.status(404).json({Error:"No se pudo encontrar el producto deseado"})}))})),c.post("/api/productos",n.default,((t,o,e)=>{var i,s;console.log("POST product recibido"),i=t,s=o,r(void 0,void 0,void 0,(function*(){const t=i.body.nombre?String(i.body.nombre):"",o=i.body.precio?Number(i.body.precio):0,e=i.body.foto?String(i.body.foto):"",r=i.body.stock?Number(i.body.stock):0,n=i.body.descripcion?String(i.body.descripcion):"",c=i.body.codigo?String(i.body.codigo):"";let u=new d.default(t,n,c,o,e,r);return u=yield u.save(),s.status(201).json({product:u})}))})),c.put("/api/productos/:id",n.default,((t,o,e)=>{var i,s;console.log("PUT product recibido"),i=t,s=o,r(void 0,void 0,void 0,(function*(){const t=i.params.id?Number(i.params.id):0,o=i.body.nombre?String(i.body.nombre):"",e=i.body.precio?Number(i.body.precio):0,r=i.body.foto?String(i.body.foto):"",n=i.body.stock?Number(i.body.stock):0,c=i.body.descripcion?String(i.body.descripcion):"",u=i.body.codigo?String(i.body.codigo):"";if(t<=0)return s.status(404).json({Error:"No se pudo encontrar el producto deseado"});let a=yield d.default.getById(t);return a?(a.setNombre(o),a.setPrecio(e),a.setFoto(r),a.setStock(n),a.setDescripcion(c),a.setCodigo(u),a.update(),s.status(201).json({product:a})):s.status(404).json({Error:"No se pudo encontrar el producto deseado"})}))})),c.delete("/api/productos/:id",n.default,((t,o,e)=>{var i,s;console.log("DELETE product recibido"),i=t,s=o,r(void 0,void 0,void 0,(function*(){const t=i.params.id?Number(i.params.id):0;return t<=0?s.status(404).json({Error:"No se pudo encontrar el producto deseado"}):(d.default.deleteById(t),s.status(204).json({Message:"Exito al eliminar el producto"}))}))})),o.default=c},860:t=>{t.exports=require("express")},439:t=>{t.exports=require("http")},952:t=>{t.exports=require("socket.io")},147:t=>{t.exports=require("fs")}},o={};!function e(r){var i=o[r];if(void 0!==i)return i.exports;var s=o[r]={exports:{}};return t[r].call(s.exports,s,s.exports,e),s.exports}(519)})();